<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>{$row['hd_title']}</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <base href="{$yobyurl}">
    <link rel="stylesheet" href="weui/weuix.min.css"/>
    <script src="weui/zepto.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
</head>

<body>

<script type="text/javascript" src='http://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>
<?php
$wx = $_W['account']['jssdkconfig'];
$wx['url'] ='http://'.$_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] ;
?>

{if $op == "failed"}
Failed!!
{elseif $op == "ok"}
<?php var_dump($instance) ?>
<?php var_dump($type) ?>
{elseif $op == "redirect"}
<script>
    window.location.href = "<?php echo $redirect; ?>";
</script>
{else}
<input class="btn btn-primary btn-lg" id="btnScan" type="submit" value="扫码" name="submit"></td>
<script>
    var appIdstr = "{$wx['appId']}";
    var timestampstr = "{$wx['timestamp']}";
    var nonceStrstr = "{$wx['nonceStr']}";
    var signaturestr = "{$wx['signature']}";
    wx.config({
        debug: true,
        appId: appIdstr,
        timestamp: timestampstr,
        nonceStr: nonceStrstr,
        signature: signaturestr,
        jsApiList: [
            'scanQRCode'
        ]
    });
    wx.ready(function () {
        //扫描二维码
    });

    document.getElementById("btnScan").onclick = function fun() {
        wx.scanQRCode({
            needResult: 1,//0是微信处理,1是结果
            desc: '我们自己来处理结果',
            scanType: ["qrCode", "barCode"],
            success: function (res) {
                var result = res.resultStr;
                var urlx = "{$_W['siteroot']}app/index.php?keyword=" + urlencode(result) + "&c=entry&do=line&i={$weid}&m=yoby_cha&id={$id}";
                window.location.href = urlx;
            }
        });
    };
</script>
{/if}
</body>

</html>