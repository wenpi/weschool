(function(){"use strict";define("lib/overlay",[],function(){var e=function(e){this.settings=$.extend({},{overlayName:"",content:"",clickCoverClosed:!1},e)};return e.prototype={_render:function(e){var t='<div class="overlay '+this.settings.overlayName+'">								<div class="overlay-dialog" tabindex="-1">									<div class="overlay-content">'+this.settings.content+'</div>								</div>								<div class="overlay-close" data-action="overlay-close">									<span class="icon icon-close-thin"></span>								</div>							</div>							<div class="overlay-cover"></div>';$("body").append(t);var n=$(".overlay"),r=$(window),i=(r.height()-n.outerHeight())/2+(document.documentElement.scrollTop||window.pageYOffset||0),s=(r.width()-n.outerWidth())/2+(document.documentElement.scrollLeft||window.pageXOffset||0);i<=0&&(i=10),$(".overlay").css({top:i,left:s})},_destroy:function(){$(".overlay").remove(),$(".overlay-cover").remove()},_bindEvents:function(e){var t=this;$(".overlay [data-action=overlay-close]").on("click",t._destroy),$("body").on("keydown",function(e){e.keyCode==27&&$(".overlay").length&&(e.preventDefault(),t._destroy())}),e?($('.overlay [data-action="overlay-cancel"]').on("click",t._destroy),$('.overlay [data-action="overlay-confirm"]').on("click",t.settings.confirm)):$('.overlay [data-action="overlay-confirm"]').on("click",t._destroy),t.settings.clickCoverClosed&&$(".overlay-cover").click(function(e){e.preventDefault(),t._destroy()})},destroy:function(){this._destroy()},confirm:function(){var e=this;e._render(1),e._bindEvents(1)},alert:function(){var e=this;e._render(0),e._bindEvents(0)}},e}),"use strict",define("lib/template",[],function(){var e={},t={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}},n="&<>\"'/",r="&amp;|&lt;|&gt;|&quot;|&#x27;|&#x2F;",i={escape:new RegExp("["+n+"]","g"),unescape:new RegExp("("+r+")","g")};$(["escape","unescape"]).each(function(n,r){e[r]=function(e){return e===null||e===undefined?"":(""+e).replace(i[r],function(e){return t[r][e]})}});var s={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},o=/(.)^/,u={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},a=/\\|'|\r|\n|\t|\u2028|\u2029/g,f=function(t,n){var r,i=new RegExp([(s.escape||o).source,(s.interpolate||o).source,(s.evaluate||o).source].join("|")+"|$","g"),f=0,l="__p+='";t.replace(i,function(e,n,r,i,s){return l+=t.slice(f,s).replace(a,function(e){return"\\"+u[e]}),n&&(l+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(l+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(l+="';\n"+i+"\n__p+='"),f=s+e.length,e}),l+="';\n",s.variable||(l="with(obj||{}){\n"+l+"}\n"),l="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+l+"return __p;\n";try{r=new Function(s.variable||"obj","_",l)}catch(c){throw c.source=l,c}if(n)return r(n,e);var h=function(t){return r.call(this,t,e)};return h.source="function("+(s.variable||"obj")+"){\n"+l+"}",h};return{tmpl:f}}),"use strict",define("lib/pageTip",[],function(){var e=function(e){this.settings=$.extend({},{klass:"",content:"",duration:5e3,cb:function(){}},e)};return e.prototype={show:function(){this._render(),this._destroy()},_render:function(){var e='<div class="page-tip">							<div class="page-tip-content">'+this.settings.content+'</div>						  </div>						  <div class="page-cover"></div>';$("body").append(e);var t=$(".page-tip"),n=$(window),r=(n.height()-t.outerHeight())/2+(document.documentElement.scrollTop||window.pageYOffset||0),i=(n.width()-t.outerWidth())/2+(document.documentElement.scrollLeft||window.pageXOffset||0);this.settings.$tip=t,t.css({top:r,left:i})},_destroy:function(e){var t=this;setTimeout(function(){t.settings.$tip.next().remove(),t.settings.$tip.remove(),t.settings.cb&&t.settings.cb()},t.settings.duration)}},e}),define("lib/share",["./template"],function(e){var t="http://service.weibo.com/share/share.php?appkey=<%= weibo %>&url=<%= url %>&title=<%= title %>&pic=<%= pic %>",n=e.tmpl(t);return{bind:function(e,t){var r={weibo:t.weibo||1814846457,url:t.url?encodeURIComponent(t.url):encodeURIComponent(location.protocol+"//"+location.host+location.pathname),title:t.title||"",pic:t.pic?encodeURIComponent(t.pic):""};e.click(function(e){e.preventDefault(),window.open(n(r))})},trigger:function(e){var t={weibo:e.weibo||weibo||1814846457,url:e.url?encodeURIComponent(e.url):encodeURIComponent(location.protocol+"//"+location.host+location.pathname),title:e.title||"",pic:encodeURIComponent(e.pic)||""};window.open(n(t))}}}),!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("lib/wxApi",[],function(){return t(e)}):t(e,!0)}(window,function(e,t){function n(t,n,r){e.WeixinJSBridge?WeixinJSBridge.invoke(t,i(n),function(e){o(t,e,r)}):f(t,r)}function r(t,n,r){e.WeixinJSBridge?WeixinJSBridge.on(t,function(e){r&&r.trigger&&r.trigger(e),o(t,e,n)}):r?f(t,r):f(t,n)}function i(e){return e=e||{},e.appId=N.appId,e.verifyAppId=N.appId,e.verifySignType="sha1",e.verifyTimestamp=N.timestamp+"",e.verifyNonceStr=N.nonceStr,e.verifySignature=N.signature,e}function s(e){return{timeStamp:e.timestamp+"",nonceStr:e.nonceStr,"package":e.package,paySign:e.paySign,signType:e.signType||"SHA1"}}function o(e,t,n){var r,i,s;switch(delete t.err_code,delete t.err_desc,delete t.err_detail,r=t.errMsg,r||(r=t.err_msg,delete t.err_msg,r=u(e,r,n),t.errMsg=r),n=n||{},n._complete&&(n._complete(t),delete n._complete),r=t.errMsg||"",N.debug&&!n.isInnerInvoke&&alert(JSON.stringify(t)),i=r.indexOf(":"),s=r.substring(i+1)){case"ok":n.success&&n.success(t);break;case"cancel":n.cancel&&n.cancel(t);break;default:n.fail&&n.fail(t)}n.complete&&n.complete(t)}function u(e,t){var n,r,i,s;if(t){switch(n=t.indexOf(":"),e){case d.config:r="config";break;case d.openProductSpecificView:r="openProductSpecificView";break;default:r=t.substring(0,n),r=r.replace(/_/g," "),r=r.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}),r=r.substring(0,1).toLowerCase()+r.substring(1),r=r.replace(/ /g,""),-1!=r.indexOf("Wcpay")&&(r=r.replace("Wcpay","WCPay")),i=v[r],i&&(r=i)}s=t.substring(n+1),"confirm"==s&&(s="ok"),"failed"==s&&(s="fail"),-1!=s.indexOf("failed_")&&(s=s.substring(7)),-1!=s.indexOf("fail_")&&(s=s.substring(5)),s=s.replace(/_/g," "),s=s.toLowerCase(),("access denied"==s||"no permission to execute"==s)&&(s="permission denied"),"config"==r&&"function not exist"==s&&(s="ok"),t=r+":"+s}return t}function a(e){var t,n,r,i;if(e){for(t=0,n=e.length;n>t;++t)r=e[t],i=d[r],i&&(e[t]=i);return e}}function f(e,t){if(N.debug&&!t.isInnerInvoke){var n=v[e];n&&(e=n),t&&t._complete&&delete t._complete,console.log('"'+e+'",',t||"")}}function l(){if(!("6.0.2">S||T.systemType<0)){var e=new Image;T.appId=N.appId,T.initTime=x.initEndTime-x.initStartTime,T.preVerifyTime=x.preVerifyEndTime-x.preVerifyStartTime,L.getNetworkType({isInnerInvoke:!0,success:function(t){T.networkType=t.networkType;var n="https://open.weixin.qq.com/sdk/report?v="+T.version+"&o="+T.isPreVerifyOk+"&s="+T.systemType+"&c="+T.clientVersion+"&a="+T.appId+"&n="+T.networkType+"&i="+T.initTime+"&p="+T.preVerifyTime+"&u="+T.url;e.src=n}})}}function c(){return(new Date).getTime()}function h(t){b&&(e.WeixinJSBridge?t():m.addEventListener&&m.addEventListener("WeixinJSBridgeReady",t,!1))}function p(){L.invoke||(L.invoke=function(t,n,r){e.WeixinJSBridge&&WeixinJSBridge.invoke(t,i(n),r)},L.on=function(t,n){e.WeixinJSBridge&&WeixinJSBridge.on(t,n)})}var d,v,m,g,y,b,w,E,S,x,T,N,C,k,L;if(!e.jWeixin)return d={config:"preVerifyJSAPI",onMenuShareTimeline:"menu:share:timeline",onMenuShareAppMessage:"menu:share:appmessage",onMenuShareQQ:"menu:share:qq",onMenuShareWeibo:"menu:share:weiboApp",previewImage:"imagePreview",getLocation:"geoLocation",openProductSpecificView:"openProductViewWithPid",addCard:"batchAddCard",openCard:"batchViewCard",chooseWXPay:"getBrandWCPayRequest"},v=function(){var e,t={};for(e in d)t[d[e]]=e;return t}(),m=e.document,g=m.title,y=navigator.userAgent.toLowerCase(),b=-1!=y.indexOf("micromessenger"),w=-1!=y.indexOf("android"),E=-1!=y.indexOf("iphone")||-1!=y.indexOf("ipad"),S=function(){var e=y.match(/micromessenger\/(\d+\.\d+\.\d+)/)||y.match(/micromessenger\/(\d+\.\d+)/);return e?e[1]:""}(),x={initStartTime:c(),initEndTime:0,preVerifyStartTime:0,preVerifyEndTime:0},T={version:1,appId:"",initTime:0,preVerifyTime:0,networkType:"",isPreVerifyOk:1,systemType:E?1:w?2:-1,clientVersion:S,url:encodeURIComponent(location.href)},N={},C={_completes:[]},k={state:0,res:{}},h(function(){x.initEndTime=c()}),L={config:function(e){N=e,f("config",e);var t=N.check===!1?!1:!0;h(function(){var e,r,i;if(t)n(d.config,{verifyJsApiList:a(N.jsApiList)},function(){C._complete=function(e){x.preVerifyEndTime=c(),k.state=1,k.res=e},C.success=function(){T.isPreVerifyOk=0},C.fail=function(e){C._fail?C._fail(e):k.state=-1};var e=C._completes;return e.push(function(){N.debug||l()}),C.complete=function(){for(var t=0,n=e.length;n>t;++t)e[t]();C._completes=[]},C}()),x.preVerifyStartTime=c();else{for(k.state=1,e=C._completes,r=0,i=e.length;i>r;++r)e[r]();C._completes=[]}}),N.beta&&p()},ready:function(e){0!=k.state?e():(C._completes.push(e),!b&&N.debug&&e())},error:function(e){"6.0.2">S||(-1==k.state?e(k.res):C._fail=e)},checkJsApi:function(e){var t=function(e){var t,n,r=e.checkResult;for(t in r)n=v[t],n&&(r[n]=r[t],delete r[t]);return e};n("checkJsApi",{jsApiList:a(e.jsApiList)},function(){return e._complete=function(e){if(w){var n=e.checkResult;n&&(e.checkResult=JSON.parse(n))}e=t(e)},e}())},onMenuShareTimeline:function(e){r(d.onMenuShareTimeline,{complete:function(){n("shareTimeline",{title:e.title||g,desc:e.title||g,img_url:e.imgUrl,link:e.link||location.href},e)}},e)},onMenuShareAppMessage:function(e){r(d.onMenuShareAppMessage,{complete:function(){n("sendAppMessage",{title:e.title||g,desc:e.desc||"",link:e.link||location.href,img_url:e.imgUrl,type:e.type||"link",data_url:e.dataUrl||""},e)}},e)},onMenuShareQQ:function(e){r(d.onMenuShareQQ,{complete:function(){n("shareQQ",{title:e.title||g,desc:e.desc||"",img_url:e.imgUrl,link:e.link||location.href},e)}},e)},onMenuShareWeibo:function(e){r(d.onMenuShareWeibo,{complete:function(){n("shareWeiboApp",{title:e.title||g,desc:e.desc||"",img_url:e.imgUrl,link:e.link||location.href},e)}},e)},startRecord:function(e){n("startRecord",{},e)},stopRecord:function(e){n("stopRecord",{},e)},onVoiceRecordEnd:function(e){r("onVoiceRecordEnd",e)},playVoice:function(e){n("playVoice",{localId:e.localId},e)},pauseVoice:function(e){n("pauseVoice",{localId:e.localId},e)},stopVoice:function(e){n("stopVoice",{localId:e.localId},e)},onVoicePlayEnd:function(e){r("onVoicePlayEnd",e)},uploadVoice:function(e){n("uploadVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadVoice:function(e){n("downloadVoice",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},translateVoice:function(e){n("translateVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},chooseImage:function(e){n("chooseImage",{scene:"1|2",count:e.count||9,sizeType:e.sizeType||["original","compressed"]},function(){return e._complete=function(e){if(w){var t=e.localIds;t&&(e.localIds=JSON.parse(t))}},e}())},previewImage:function(e){n(d.previewImage,{current:e.current,urls:e.urls},e)},uploadImage:function(e){n("uploadImage",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadImage:function(e){n("downloadImage",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},getNetworkType:function(e){var t=function(e){var t,n,r,i=e.errMsg;if(e.errMsg="getNetworkType:ok",t=e.subtype,delete e.subtype,t)e.networkType=t;else switch(n=i.indexOf(":"),r=i.substring(n+1)){case"wifi":case"edge":case"wwan":e.networkType=r;break;default:e.errMsg="getNetworkType:fail"}return e};n("getNetworkType",{},function(){return e._complete=function(e){e=t(e)},e}())},openLocation:function(e){n("openLocation",{latitude:e.latitude,longitude:e.longitude,name:e.name||"",address:e.address||"",scale:e.scale||28,infoUrl:e.infoUrl||""},e)},getLocation:function(e){e=e||{},n(d.getLocation,{type:e.type||"wgs84"},function(){return e._complete=function(e){delete e.type},e}())},hideOptionMenu:function(e){n("hideOptionMenu",{},e)},showOptionMenu:function(e){n("showOptionMenu",{},e)},closeWindow:function(e){e=e||{},n("closeWindow",{immediate_close:e.immediateClose||0},e)},hideMenuItems:function(e){n("hideMenuItems",{menuList:e.menuList},e)},showMenuItems:function(e){n("showMenuItems",{menuList:e.menuList},e)},hideAllNonBaseMenuItem:function(e){n("hideAllNonBaseMenuItem",{},e)},showAllNonBaseMenuItem:function(e){n("showAllNonBaseMenuItem",{},e)},scanQRCode:function(e){e=e||{},n("scanQRCode",{needResult:e.needResult||0,scanType:e.scanType||["qrCode","barCode"]},function(){return e._complete=function(e){var t,n;E&&(t=e.resultStr,t&&(n=JSON.parse(t),e.resultStr=n&&n.scan_code&&n.scan_code.scan_result))},e}())},openProductSpecificView:function(e){n(d.openProductSpecificView,{pid:e.productId,view_type:e.viewType||0},e)},addCard:function(e){var t,r,i,s,o=e.cardList,u=[];for(t=0,r=o.length;r>t;++t)i=o[t],s={card_id:i.cardId,card_ext:i.cardExt},u.push(s);n(d.addCard,{card_list:u},function(){return e._complete=function(e){var t,n,r,i=e.card_list;if(i){for(i=JSON.parse(i),t=0,n=i.length;n>t;++t)r=i[t],r.cardId=r.card_id,r.cardExt=r.card_ext,r.isSuccess=r.is_succ?!0:!1,delete r.card_id,delete r.card_ext,delete r.is_succ;e.cardList=i,delete e.card_list}},e}())},chooseCard:function(e){n("chooseCard",{app_id:N.appId,location_id:e.shopId||"",sign_type:e.signType||"SHA1",card_id:e.cardId||"",card_type:e.cardType||"",card_sign:e.cardSign,time_stamp:e.timestamp+"",nonce_str:e.nonceStr},function(){return e._complete=function(e){e.cardList=e.choose_card_info,delete e.choose_card_info},e}())},openCard:function(e){var t,r,i,s,o=e.cardList,u=[];for(t=0,r=o.length;r>t;++t)i=o[t],s={card_id:i.cardId,code:i.code},u.push(s);n(d.openCard,{card_list:u},e)},chooseWXPay:function(e){n(d.chooseWXPay,s(e),e)}},t&&(e.wx=e.jWeixin=L),L}),define("lib/wxShare",["lib/wxApi"],function(e){return function(t,n){return e.config({debug:n?n:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:t.jsApiList}),{ready:function(t){e.ready(t)},error:function(t){e.error(t)},share:function(e){this.shareTimeline(e.timeline||e),this.shareAppMessage(e.appMessage||e),this.shareQQ(e.qq||e),this.shareWeibo(e.weibo||e)},shareTimeline:function(t){e.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){t.success&&t.success()},cancel:function(){}})},shareAppMessage:function(t){e.onMenuShareAppMessage(t)},shareQQ:function(t){e.onMenuShareQQ(t)},shareWeibo:function(t){e.onMenuShareWeibo(t)}}}}),"use strict",define("lib/nameCard",["./template"],function(e){var t=function(t,n){function o(e){var t=$(window).height(),n=$(window).width(),r=$("body").height(),i=e.offset().top,s=e.offset().left,o=i-$(document).scrollTop(),u=o<t/2?"down":"up",a={targetTop:u==="down"?i+25:"auto",targetBottom:u==="up"?r-i-25:"auto",targetLeft:s+5};return a}function u(e,t){var n,r={nameCardTpml:'<div class="nameCard">                                <div class="info">                                    <span class="avatar">                                        <img src="<%- avatar %>">                                    </span>                                    <span class="nickname"><%- nickname %></span>                                    <div class="left-line"></div>                                </div>                                <ul class="detail">                                    <li><%- location %></li>                                    <% if (industry) { %>                                        <li><%- industry.name %></li>                                    <% } %>                                </ul>                                <% if (labels.length > 0){ %>                                <ul class="label">                                    <% for(var j=0, j_len=labels.length; j< j_len; j++) { %>                                    <li><%- labels[j].name %></li>                                    <% } %>                                </ul>                                <% } %>                            </div>',api_url:"/apis/open/users/"+e},i={nameCardTpml:'<div class="nameCard">                                <a class="info" <% if (is_tutor){ %>href="/mentor/<%- id %>"<% } %> target="_blank">                                    <span class="avatar">                                        <img src="<%- avatar %>">                                    </span>                                    <span class="nickname"><%- nickname %></span>                                    <span class="realname"><%- realname %>                                    <% if (gender){ %>                                        <i class="gender"><%- gender %></i>                                        <% } %>                                    </span>                                    <% if (is_tutor){ %>                                    <ul>                                        <li>                                            <span>见过</span>                                            <span class="count"><%- meets_count %></span>                                            <span class="unit">次</span>                                        </li>                                        <li>                                            <span>评价</span>                                            <span class="count"><%- topic_reviews_count %></span>                                            <span class="unit">篇</span>                                        </li>                                    </ul>                                    <% } %>                                    <div class="left-line"></div>                                </a>                                <ul class="detail">                                    <li><%- location %></li>                                    <% if (industry) { %>                                        <li><%- industry.name %></li>                                    <% } %>                                    <li class="company"><%- company %></li>                                    <li><%- position %></li>                                    <li><%- age_group %></li>                                </ul>                                <% if (labels.length > 0){ %>                                <ul class="label">                                    <% for(var j=0, j_len=labels.length; j< j_len; j++) { %>                                    <li><%- labels[j].name %></li>                                    <% } %>                                </ul>                                <% } %>                            </div>',api_url:"/apis/open/meet/"+e+"/user"};switch(t){case"user":n=r;break;case"tutor":n=i}return n}function a(t,n,r,o){var a=u(n,r);$.ajax({url:a.api_url,type:"GET",dataFilter:function(e){return e.substring(16)},success:function(t){i=e.tmpl(a.nameCardTpml);switch(r){case"user":s=i({avatar:t.avatar,nickname:t.nickname,location:t.location,industry:t.industry,labels:t.labels});break;case"tutor":var n;switch(t.gender){case"male":n="男";break;case"female":n="女";break;default:n=null}var u;switch(t.age_group){case 1900:u="60前";break;case 1960:u="60后";break;case 1970:u="70后";break;case 1980:u="80后";break;case 1985:u="85后";break;case 1990:u="90后";break;case 1995:u="95后";break;case 2e3:u="00后"}s=i({id:t.id,is_tutor:t.is_tutor,avatar:t.avatar,nickname:t.nickname,realname:t.realname,gender:n,meets_count:t.meets_count||0,topic_reviews_count:t.topic_reviews_count||0,location:t.location,industry:t.industry,company:t.company,position:t.position,age_group:u,labels:t.labels})}$(".nameCard").size()!==0&&$(".nameCard").remove(),$("body").append(s),$(".nameCard").css({position:"absolute",top:o.targetTop,bottom:o.targetBottom,left:o.targetLeft}).show();return},error:function(e){return},dataType:"json",contentType:"application/json; charset=utf-8"})}$("body").css("position","relative");var r,i,s;$(window).width()>767&&(t.mouseover(function(){var e=$(this),t=e.attr("data-id"),i=o(e);a(e,t,n,i),clearTimeout(r)}).mouseout(function(){r=setTimeout(function(){$(".nameCard").remove()},200)}),$(document).on({mouseover:function(){clearTimeout(r)},mouseout:function(){r=setTimeout(function(){$(".nameCard").remove()},200)}},".nameCard"))};return{card:t}}),require(["lib/overlay","lib/template","lib/pageTip","lib/share","lib/wxShare","lib/nameCard"],function(e,t,n,r,i,s){function o(e){var t,n,r,i;$(".overlay .form-error").text("");for(r in e){i=e[r],t=$("#"+r),n=t.parents(".form-group").find(".form-error");if(i.required&&t.val().trim()=="")return n.text(i.required),!1;if(i.maxlength&&t.val().trim().length>i.maxlength)return n.text("最多"+i.maxlength+"个字哦"),!1;if(i.minlength&&t.val().trim().length<i.minlength)return n.text("最少"+i.minlength+"个字哦"),!1}return!0}function u(n,r){var i=current_user.location,s=i==tutor_city?!0:!1;if(s)a(n,r);else{var o=i==null||i==""?'<p class="overlay-text-center">您还未设置常居地，行家在<%- city %>，确定要约这位行家吗？</p>                                <span class="overlay-info"><a href="javascript: void 0;" class="changeLocation">一键设置您的长居地为"<%- city %>"</a></span>                                <div class="overlay-buttons">                                    <a href="javascript: void 0;" class="btn-default btn-md" data-action="overlay-close">取消</a>                                    <a href="javascript: void 0;" class="btn-primary btn-md" data-action="overlay-confirm">继续约见</a>                                </div>':'<p class="overlay-text-center">您的常居地是'+i+'，行家在<%- city %>，确定要约这位行家吗？</p>                                <span class="overlay-info"><a href="javascript: void 0;" class="changeLocation">一键设置您的长居地为"<%- city %>"</a></span>                                <div class="overlay-buttons">                                    <a href="javascript: void 0;" class="btn-default btn-md" data-action="overlay-close">取消</a>                                    <a href="javascript: void 0;" class="btn-primary btn-md" data-action="overlay-confirm">继续约见</a>                                </div>',u=t.tmpl(o)({city:tutor_city}),f=new e({content:u,confirm:function(){f.destroy(),a(n,r)}});f.confirm(),$(".overlay .changeLocation").on("click",function(){$.ajax({url:"/apis/open/users/current",data:JSON.stringify({location:tutor_city}),type:"PUT",dataType:"json",contentType:"application/json; charset=utf-8",complete:function(e){current_user.location=tutor_city,f.destroy(),a(n,r)}})})}}function a(r,i){var s=$("#tutorInfo"),u=s.find("img").attr("src"),a=s.find(".tutor-name").text(),f=parseInt(s.find(".tutor-name").attr("data-tutor_id")),l=parseInt(r.attr("data-user_id")),i=i?i=="这个人很懒，什么都没写"?"":i:"",c=[],h=0,p=0,d=$("#topicList .topic-item"),v=d.length,m,g=!1;for(var y=0;y<v;y++)m=d.eq(y).find(".topic-title"),c.push({title:m.text(),id:m.attr("data-topic_id"),price:m.attr("data-topic_price"),is_meeting:m.attr("data-is_meeting")=="true",is_init_one:!1}),!g&&!c[y].is_meeting&&(h=parseInt(c[y].price),p=parseInt(c[y].id),c[y].is_init_one=!0,g=!0);var b='<div class="booking-topic-info">                                <div class="booking-tutor-left">                                    <span class="booking-tutor-avatar">                                        <img src="<%- img %>">                                    </span>                                    <strong class="booking-tutor-name"><%- tutorName %></strong>                                </div>                                <div class="booking-topic-content">                                    <div class="booking-topics" id="bookingTopics">                                        <% for(var j=0; j< topics.length; j++) {%>                                           <a href="javascript: void 0;" class="<% if (topics[j].is_init_one){ %>btn-primary<% }else{ %>btn-default<% } %><% if(topics[j].is_meeting){ %> btn-disable<% } %> btn-lg" data-topic_id="<%- topics[j].id %>" data-topic_price="<%- topics[j].price %>" <% if (topics[j].is_init_one){ %> data-selected="true" <% } %>><%- topics[j].title %></a>                                        <% } %>                                    </div>                                    <% if(isInit) { %>                                    <p class="booking-topic-price" id="showPrice">价格 ： <strong class="booking-topic-total-price"><%- price %></strong>元/次</p>                                    <% } %>                                </div>                            </div>                            <div class="step">                                <span>学员申请<em>1</em><i class="step-line"></i></span>                                <span>行家确认<em>2</em><i class="step-line"></i></span>                                <span>学员付款<em>3</em><i class="step-line"></i></span>                                <span>协商见面<em>4</em><i class="step-line"></i></span>                                <span>见面评价<em>5</em><i class="step-line"></i></span>                            </div>                            <div class="booking-form">                                <form>                                    <div class="form-group">                                        <label class="form-group-title" for="question">告诉行家你要请教的问题：（30-300字）</label>                                        <textarea class="booking-question" id="question" name="question" maxlength="300" placeholder="例如：回国半年，准备创业，考虑做一个健身O2O项目；之前在美国做律师，是一个很大的转变，心里没底，想快速了解和适应国内的创业环境，向行家请教初始团队组建和运营的经验，以及帮忙分析产品模式。"></textarea>                                        <p class="form-error"></p>                                    </div>                                    <div class="form-group">                                        <label class="form-group-title" for="description">介绍自己当前的情况：（30-300字）</label>                                        <textarea class="booking-description" id="description" name="description" maxlength="300" placeholder="例如：我目前在一家科技媒体做运营，工作3年，传媒大学毕业，业余运营一个微信公众号，平时喜欢写文章，希望职业上有更好突破。"><%- description %></textarea>                                        <p class="form-error"></p>                                    </div>                                    <div class="form-group">                                        <label class="form-group-title" for="disableTime">未来两周方便见面的时间：（2-50字）</label>                                        <input class="booking-require" id="disableTime" name="disableTime" maxlength="50" placeholder="例如：下周末下午或周二到周五晚上">                                        <p class="form-error"></p>                                    </div>                                    <div class="form-group">                                        <label class="form-group-title" for="expectedPlace">平时活动的区域：（2-50字）</label>                                        <input class="booking-require" id="expectedPlace" name="expectedPlace" maxlength="50" placeholder="例如：工作在酒仙桥，家住东直门">                                        <p class="form-error"></p>                                    </div>                                </form>                            </div>                            <div class="overlay-buttons-right">                                <a href="javascript: void 0;" class="btn-default btn-md" data-action="overlay-close">取消</a>                                <a href="javascript: void 0;" class="btn-primary btn-md" data-action="overlay-confirm" data-analyze="Meet:Launch:'+tutor.id+":"+current_user.id+'">发送</a>                            </div>',w=t.tmpl(b),E=w({img:u,tutorName:a,price:h,topicId:p,description:i,topics:c,isInit:g}),S=new e({overlayName:"booking-overlay",content:E,confirm:function(){if(!g){var r=new n({content:"完成现有的约见才可以想约就约哦",duration:3e3});r.show();return}var i=parseInt($("#bookingTopics [data-selected]").attr("data-topic_id")),s=$("#question").val().trim(),u=$("#description").val().trim(),a=$("#disableTime").val().trim(),c=$("#expectedPlace").val().trim(),h={question:{required:"＊请填写您打算向TA请教的问题",minlength:30,maxlength:300},description:{required:"＊请填写一些您的情况",minlength:30,maxlength:300},disableTime:{required:"＊请填写方便的时间",minlength:2,maxlength:50},expectedPlace:{required:"＊请填写期望地点",minlength:2,maxlength:50}},p={owner_id:l,tutor_id:f,topic_id:i,question:s,owner_description:u,busy_time:a,expected_place:c};o(h)&&$.ajax({url:"/apis/open/meets",type:"POST",data:JSON.stringify(p),dataFilter:function(e){return e.substring(16)},success:function(n){S.destroy();var r=n.order_id,i='<h3>提交成功！</h3>                                                <p>                                                    专业的行家顾问将在1个工作日内审核您的约见申请，提交行家确认，并给您及时的反馈。<br><br>                                                    您可随时在个人主页查看预约进展。                                                </p>                                                <div class="overlay-buttons">                                                    <a href="/meet/<%- id %>/" class="btn-primary btn-md">查看申请</a>                                                    <a href="javascript: void 0;" class="btn-default btn-md" data-action="overlay-close">返回话题页</a>                                                </div>',s=t.tmpl(i),o=s({id:r}),u=new e({content:o});u.alert()},error:function(n){S.destroy();var r=n.status===401,i=r?{}:$.parseJSON(n.responseText.substring(16)),s={repetitive_meet_error:"您的约见请求正在处理中，请不要重复约见。",mobile_not_verified_error:"检测到您尚未验证手机号码，暂时不能预约。",meet_self_error:"抱歉，您不能自己约见自己哦……"},o='<h3>提交失败</h3>                                                <p style="text-align: center;"><%- msg %></p>                                                <div style="text-align: center;" class="overlay-buttons">                                                    <a href="javascript: void 0;" class="btn-default btn-md" data-action="overlay-close">确定</a>                                                </div>',u=t.tmpl(o),a=u({msg:r?"请登录后进行约见":s[i.code]?s[i.code]:"请求出错，请稍后尝试"}),f=new e({content:a});f.alert()},dataType:"json",contentType:"application/json; charset=utf-8"})}});S.confirm(),$(document).delegate("#bookingTopics a","click tap",function(e){e.preventDefault();var t=$(this),n=$("#showPrice");if(t.hasClass("btn-primary")||t.hasClass("btn-disable"))return;t.siblings().removeClass("btn-primary").addClass("btn-default").removeAttr("data-selected"),t.removeClass("btn-default").addClass("btn-primary").attr("data-selected","true");var r=t.attr("data-topic_price");n.find(".booking-topic-total-price").text(parseFloat(r))})}function f(e,t){var n=/^1[3|4|5|7|8][0-9]\d{8}$/;return t.text(""),n.test(e)?!0:(t.text("请输入正确的11位手机号码"),!1)}function l(e,t,n,r,i,s){$.ajax({url:"/apis/open/mobile_verification",data:JSON.stringify({mobile:r.val().trim(),code:parseInt(i.val().trim())}),type:"post",dataType:"json",contentType:"application/json; charset=utf-8",dataFilter:function(e){return e.substring(16)},success:function(i){typeof ga=="function"&&ga("send","event","User","MobileCert","",current_user.id),c(e,t,n,r,s)},error:function(e){var t=$.parseJSON(e.responseText.substring(16));if(t=="verification_code_error"){i.parents(".form-group").find(".form-error").text("验证码错误");return}}})}function c(e,t,n,r,i){$.ajax({url:"/apis/open/users/current",data:e,type:"PUT",dataType:"json",contentType:"application/json; charset=utf-8",dataFilter:function(e){return e.substring(16)},success:function(e){i.destroy(),h(t)},error:function(e){var t=$.parseJSON(e.responseText.substring(16));if(t.code=="min_length_is_2"){n.parents(".form-group").find(".form-error").text("真实姓名最小长度为2");return}if(t.code=="parameter_error"&&t.errors[0].code=="mobile_already_exists"){r.parents(".form-group").find(".form-error").text("此手机号已经注册");return}}})}function h(e){$.ajax({url:"/apis/open/users/current",type:"GET",dataFilter:function(e){return e.substring(16)},success:function(t){u(e,t.description)},error:function(){u(e)},dataType:"json",contentType:"application/json; charset=utf-8"})}$(document).delegate("#bookingBtn, #meetingBtn","click tap",function(r){r.preventDefault();var i=validateObj,s=$(this);if(s.attr("data-login")=="false")return;if(i.is_self){var o=new n({content:"抱歉，您不能自己约见自己哦……",duration:3e3});o.show();return}if(!i.is_mobile_verified||!i.has_realname){var u='<h3>约见前请您先完善自己的信息，以便行家联系您</h3>                                <form>                                    <% if(!has_realname){ %>                                    <div class="form-group">                                        <label for="realname">真实姓名</label>                                        <div class="form-item">                                            <input id="realname" name="realname" required="" type="text" value="" maxlength="10">                                            <p class="form-error"></p>                                        </div>                                    </div>                                    <% } %>                                    <% if(!is_mobile_verified){ %>                                    <div class="form-group">                                        <label for="mobile">手机号</label>                                        <div class="form-item">                                            <input id="mobile" name="mobile" required="" type="text" value="">                                            <a class="btn-default btn-sm validate-btn" href="javascript: void 0;" id="mobileValidateBtn">发送验证码</a>                                            <p class="form-error"></p>                                        </div>                                    </div>                                    <div class="form-group">                                        <label for="verification">验证码</label>                                        <div class="form-item">                                            <input id="verification" name="verification" required="" type="text" value="">                                            <p class="form-error"></p>                                        </div>                                    </div>                                    <div class="form-group">                                        <label for="verification"></label>                                        <div class="form-item">                                            如果您一直收不到验证码，请拨打客服电话4000691791                                        </div>                                    </div>                                    <% } %>                                </form>                                <div class="overlay-buttons-right">                                    <a href="javascript: void 0;" class="btn-default btn-md" data-action="overlay-close">取消</a>                                    <a href="javascript: void 0;" class="btn-primary btn-md" data-action="overlay-confirm">提交</a>                                </div>',a=t.tmpl(u),p=a({has_realname:i.has_realname,is_mobile_verified:i.is_mobile_verified}),d=new e({overlayName:"validate-overlay",content:p,confirm:function(){var e=$("#realname"),t=$("#mobile"),n=$("#verification"),r=/^\d{4}$/,o;if(e.length&&e.val().trim()==""){e.parents(".form-group").find(".form-error").text("请填写真实姓名");return}if(t.length&&!f(t.val().trim(),t.parents(".form-group").find(".form-error")))return;if(n.length&&!r.test(n.val().trim())){n.parents(".form-group").find(".form-error").text("请填写正确的验证码");return}!i.has_realname&&!i.is_mobile_verified?(o=JSON.stringify({mobile:t.val().trim(),realname:e.val().trim()}),l(o,s,e,t,n,d)):!i.has_realname&&i.is_mobile_verified?(o=JSON.stringify({realname:e.val().trim()}),c(o,s,e,t,d)):i.has_realname&&!i.is_mobile_verified&&(o=JSON.stringify({mobile:t.val().trim()}),l(o,s,e,t,n,d))}});d.confirm(),$(document).delegate("#mobileValidateBtn","click tap",function(e){function s(e){if(r===0){r=60,e.removeClass("btn-disable").text("发送验证码"),clearTimeout(i);return}i=setTimeout(function(){e.text(r-- +"秒后重新获取"),s(e)},1e3)}e.preventDefault();var t=$(this),n=t.prev().val().trim(),r=60,i=null;if(!f(n,t.parents(".form-group").find(".form-error")))return;t.addClass("btn-disable"),t.text(r-- +"秒后重新获取"),s(t),$.ajax({url:"/apis/open/send_mobile_verification",data:JSON.stringify({mobile:n}),type:"post",dataType:"json",contentType:"application/json; charset=utf-8",dataFilter:function(e){return e.substring(16)},success:function(e){},error:function(e){clearTimeout(i),r=60,t.removeClass("btn-disable").text("发送验证码");var n=$.parseJSON(e.responseText.substring(16)),s=n.code||"unknow",o={mobile_verificated:"这个号码已经验证过了",parameter_error:"请输入正确的11位手机号码",unknow:"获取验证码失败，请重新获取",mobile_exists:"这个号码已经验证过了"},u=t.parents(".form-group").find(".form-error");s==="parameter_error"&&n.errors[0]&&n.errors[0].code==="mobile_already_exists"?u.text(o.mobile_verificated):u.text(o[s])}})});return}if(!$("#topicList li").length){var v=new n({content:"这位行家暂时不能约见，敬请期待……",duration:3e3});v.show();return}h(s)}),$(document).delegate("#moreComments","click tap",function(e){$("#comments li").removeClass("hidden"),$(this).remove()}),$(document).delegate("#followBtn","click tap",function(e){e.preventDefault();var t=$(this),n=parseInt(t.attr("data-tutor_id"));if(t.attr("data-login")=="false")return;if(t.hasClass("followed"))return;$.ajax({url:"/apis/open/user_follow",method:"POST",data:JSON.stringify({follower_id:n}),dataType:"json",dataFilter:function(e){return e.substring(16)},success:function(e){t.addClass("followed").html('<span class="icon icon-heart"></span>已在我的心愿单');var n=$("#followersNum .num"),r=parseInt(n.text());r&&n.text(++r)},error:function(e){},contentType:"application/json; charset=utf-8"})}),$(document).delegate(".toggleBtn","click",function(e){e.preventDefault();var t=$(this),n=t.siblings(".topicFold"),r=n.find(".fold"),i=t.text();n.toggleClass("topic-content-fold"),t.toggleClass("opened"),r.toggle(),i==="显示更多"?t.html('<span class="icon icon-fold"></span>收起'):t.html('<span class="icon icon-spread"></span>显示更多')});var p=$(".topicIntroduction");for(var d=0;d<p.length;d++){var v=$(p[d]),m=v.height(),g=v.parent(),y=g.height(),b=g.find(".fold"),w=g.siblings(".toggleBtn");m<=y?b.toggle():w.css({visibility:"visible"})}var E=$(".tutorAvatar").find("img").attr("src"),S=$.trim($(".topicTitle").eq(0).text()),x=$.trim($(".topicIntroduction").eq(0).text().slice(0,115));window._bd_share_config={share:{tag:"shareTutor",bdText:tutor.realname,bdDesc:tutor.realname,bdUrl:location.protocol+"//"+location.host+location.pathname,bdPic:E,onBeforeClick:function(e,t){return e==="tsina"&&(t.bdText=S+"【"+tutor.realname+"，"+tutor.summary+"】分享自@在行 ：一对一、面对面，行家为你出谋划策"),t},bdSnsKey:{tsina:"1814846457"}}},$("head").append($("<script>").attr("src","http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-(new Date)/36e5)));var T=i({appId:weixin_mp_config.appId,timestamp:weixin_mp_config.timestamp,nonceStr:weixin_mp_config.nonceStr,signature:weixin_mp_config.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]},!1);T.ready(function(){T.share({timeline:{title:"【在行】"+S+" —— "+tutor.realname+"（"+tutor.summary+"）",link:location.protocol+"//"+location.host+location.pathname,desc:x,imgUrl:"http:"+E,success:function(){typeof ga=="function"&&ga("send","event","Share","Timeline","mentor",tutor.id)}},appMessage:{title:"【在行】"+S+" 摘要："+tutor.realname+"（"+tutor.summary+"）",desc:x,link:location.protocol+"//"+location.host+location.pathname,imgUrl:"http:"+E,success:function(){typeof ga=="function"&&ga("send","event","Share","Weixin","mentor",tutor.id)}},qq:{title:"【在行】"+S+" 摘要："+tutor.realname+"（"+tutor.summary+"）",desc:x,link:location.protocol+"//"+location.host+location.pathname,imgUrl:"http:"+E},weibo:{title:S+"【"+tutor.realname+"，"+tutor.summary+"】分享自@在行 ：一对一、面对面，行家为你出谋划策",desc:S+"【"+tutor.realname+"，"+tutor.summary+"】分享自@在行 ：一对一、面对面，行家为你出谋划策",link:location.protocol+"//"+location.host+location.pathname,imgUrl:"http:"+E}})});if($(".remarkPages").length){var N=$("#remarks").find("ul"),C=N.length,k=0,L=$(".markCurrentPage");$(".remarkNext").click(function(){k=++k%C,N.eq(k).show().siblings("ul").hide(),L.text(k+1)}),$(".remarkPrev").click(function(){k=(C+ --k)%C,N.eq(k).show().siblings("ul").hide(),L.text(k+1)})}typeof HuihuiJSBridge=="object"&&location.hash==="#_huihuiBooking"&&$("#bookingBtn").trigger("click"),$(".withTooltip").tooltipster({content:"约见新行家的前两位学员有机会享受优惠破冰价，先抢先得哦",contentAsHTML:!0,position:"top-right"})}),define("content",function(){})})();